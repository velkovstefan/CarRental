# CarRental
## Вовед
Car Rental е веб апликација која овозможува лесно и едностано online изнајмување на автомобили. Апликацијата на сопствениците и нејзините администратори им нуди и лесно одржување на автотмтбилите кој се достапни за изнајмување, односно надлежните ќе можат лесно да водат евиденција за тоа кој автомобили се изнајмени и во кој период и воедно дали истите треба да се сервисираат или не. Car Rental на соодветните корисници им нуди и детален увид на секакви трансакции кој се направени во апликацијата додека сопствениците имаат увид на сите трансакции вклучувајки ги и оние кој се направени и за сервис на автомобилите.

## Функционалности
Се со цел да се раздели логиката на апликацијата таа е организирана во MVC архитектура која е поделена на Модел, Поглед и Контролер. Моделите се одговорни за структурата на податоците во апликацијата, погледите се одговорни за корисничкиот интерфејс на апликацијата додека контролерите се одговорни за примање на барањата, обработување на податоците и враќање на соодветен одговор.

Апликацијата функционира врз основа на неколку модели:

* Car
* RentedCars
* Balance
* Transaction
* Review


Додека за пристап до соодветните податоци од страна на погледите ги користиме следниве ViewModel : 
* CarsViewModel  
* DetailsViewModel  
* RentedCarsViewModel  
* TransactionViewModel

# Модели

## Car Модел

Car моделот е одговорен за сруктурирање на податоците кој апликацијата ќе ги чува за автомобилите кој корисниците ќе може да ги изнајмат. Моделот поседува својства за:

* Брендот  
* Моделот  
* Година на производство  
* Цената за еден ден  
* Број на изнајмувања пред да е потребно да се направи сервис  
* Линк до слика за автомобилот  
* Моќност на моторот  
* Потрошувачка на гориво  
* Капацитет на резервоар  
* Тип на автомобил  
* Тип на гориво  
* Број на врати  
* Број на седишта  
* Тип на менувач  
* Вкупен број на изнајмувања

Моделот вклучува и примарен клуч идентификатор именуван како Id

## RentedCars Модел

RentedCars моделот содржи параметри за евидентирање на изнајмувањето на автомобилот, во моделот се вклучени податоци како Id на изнајмувањето, UserId односно Id на корисникот гој го извршил изнајмувањето, CarId кое означува Id на автомобилот кој бил изнајмен,  датум на почеток на изнајмувањето и датум на завршување на изнајмувањето.

## Balance Модел

Balance моделот е одговорен за моделирање на податоците поврзани со тековната состојба на средствата кој ги поседуваат корисниците за изнајмување на автомобилите. Воедно овој модел се користи и за состојбата на средствата кој ги има компанијата со која може да ги сервисира автомобилите.  
Balance моделот содржи својства за: Id кое означува примарен клуч идентификатор на сметката, UserId кој означува идентификатор за корисникот на кому му припаѓа сметката и MoneyBalance кое претставува количеството на сретства во сметката.

## Transaction Модел

При секоја интеракција на корисникот каде што е вклучена операција со неговата сметка за средства се врши запис во табелата за трансакции во базата на податоци. Табелата за трансакции ги содржи атрибутите од Transaction моделот кој ги содржи следните својства: 

* Id на трансакцијата  
* Причина за извршената трансакција  
* Количество на префрлени средства  
* Датум на извршената трансакција  
* UserIdFrom, Id на корисникот од кој се префрлени средствата  
* UserIdTo, Id на корисникот до кој се префрлени средствата

## Review Модел

Се со цел компанијата да има увид за тоа колку нејзините корисници се задоволни од одреден автомобил апликацијата овозможува функционалност за оценување и коментирање на автомобилите. Податоците за оваа функционалност се структурирани со помош на Review моделот кој ги содржи следните својства:

* Id, идентификатор за оценката  
* Оценка  
* UserId, Id кое означува идентификатор за корисникот кој ја дал оценката  
* Име на корисникот  
* CarId, кое означува Id на автомобилот кој бил изнајмен  
* Коментар
# Контролери

Операциите за управување со автомобилите односно креирање, читање, ажурирање и бришење (CRUD) се имплементирани во CarsController класата користејќи ја автоматизираната поддршка за **scaffolding** која е обезбедена од ASP.NET рамката. 

## CarsController

Како што беше напоменато погоре CRUD операциите во CarsController беа првично имплементирани автоматски со помош на scaffolding алатката која ја нуди самата ASP.NET, но дел од истите беа променетеи се со цел да ги задоволат барањата на апликацијата.

## Index акција

Index акцијата е одговорна да состави листа со податоците за автомобилите кој се внесени во базата на податоци и истите да ги прати на соодветниот поглед. Покрај тоа оваа акција потребно е да провери за секој од автомобилите дали постои запис во табелата со изнајмени автомобили кој го опфаќаат денешниот датум и истите да ги означи како изнајмени во CarsViewModel објектот и истиот да го додаде во листата која ќе се испрати до погледот. Index акцијата пред да ја состави листата од автомобили проверува дали корисникот испратил некакви податоци за филтрирање на автомобилите. Податоците за филтрирање се испраќаат преку соодветни QueryString параметри. За секој од QueryString параметрите се составува предикат за соодветното својство од Car класата и вредност на QueryString параметарот, потоа го креира ламда изразот со соодветниот предикат и параметар како аргументи, потоа со помош на ламда изразот се филтрираат записите во Cars ентитетот.

## MyRentedCars акција

MyRentedCars акцијата е одговорна да ги пронајде сите записи во базата на податоци односно во табелата на изнајмени автомобили каде што тековниот најавен корисник има изнајмено автомобил. Откако ќе го направи тоа, акцијата е потребно за секој запис да го пронајде автомобилот преку неговото Id во табелата за автомобили, да креира RentedCarsViewModel објект со податоците за автомобилот и да провери дали изнајмувањето сеуште трае и секој таков автомобил да го означи како изнајмен во RentedCarsViewModel објектот. Потоа овие објекти да ги додаде во листа која ќе се испрати до погледот.

## RentServiceFunction акција

RentServiceFunction акцијата е одговорна да ги обработи барањата за изнајмување на автомобилите и соодветно да врати порака дали операцијата била успешно завршена. На RentServiceFunction акцијата се проследува аргумент од типот на RentData кој содржи Id на автомобилот кој се изнајмува, датумот на почеток на изнајмувањето и датум на завршување на изнајмувањето. Акцијата има задача најпрвин да провери дали датумите се коректни односно дали датумот на завршување на изнајмувањето не е пред датумот на почеток на изнајмувањето, доколку датумите не се коректни се враќа соодветна порака до корисникот и операцијата завршува. Додека доколку се коректни се проверува дали во табелата на изнајмени автомобили се опфатени датумите од почеток до крај на изнајмување на возилото, доколку постојат такви записи се враќа порака дека возилото не е достапно. Доколку е достапно возилото за истото се проверува дали е во состојба на изнајмување односно дали својството NumberOfRentals не е 0, доколку е 0 се враќа порака до корисникот дека возилото треба да се сервисира. Доколку возилото е во добра состојба се одредува цената на изнајмувањето и се проверува дали корисникот има доволно средства на својата сметка. Доколку нема доволно средства се враќа соодветна порака до корисникот. Доколку има средства се прави нов запис во табелата за изнајмени автомобили и во табелата за извршени трансакции и се префрлаат средствата од сметката на корисникот на сметката на сопственикот.

## ServiceCar акција

ServiceCar акцијата има задача да прими барање од страна на сопственикот или администраторот за сервисирање на одредено возило. Акцијата како аргумент прима објект од класата ServiceData кој содржи  податоци за Id на автомобилот и типот на сервисот. Акцијата најпрвин го пронаоѓа записот за автомобилот во табелата со автомобили според неговото Id и проверува дали атрибутот NumberOfRentals е еднаков на 10\. Доколку NumberOfRentals е еднаков на 10, автомобилот бил претходно сервисиран и нема потреба од сервисрање, доколку NumberOfRentals не е 10 се проверува дали е неопходно да се направи голем сервис. Доколку е побарано да се направи мал сервис а автомобилот е во состојба каде што е потребен голем сервис се враќа порака дека е потребно да се направи голем сервис и операцијата престанува, во спротивно операцијата продолжува и проверува дали во временскиот периодот кој ќе го опфати сервисот има запис во табелата за изнајмени возила. Доколку има акцијата враќа дека Автомобилот е недостапен и операцијата се прекинува, во спротивно сервисот е успешно извршен, потребните средства се одземаат од сметката на сопсвеникот и се додава нов запис во табелата за трансакции како и во табелата за изнајмени возила се со цел да се означи дека возилото е недостапно.

## TransactionsController

TransactionsController е одговорен да ги обработува барањата поврзани со евиденција, управување и бришење записи од ентитетот за трансакции. Поконкретно кажано преку соодветни акции овој контролер спроведува повратни информации до соодветните погледи за: листање, детален поглед и бришење на записите. Записите во ентитетот за трансакции се од тип на Transaction моделот.

## Index акција 

Index акција е одговорна за секој најавен корисник на веб апликацијата да ги пронајде сите извршени трансакции и истите да ги испрати до соодветниот поглед каде тие би се излистале. Index акција пред да ги испрати податоците до погледот врши неколку операции. Најпрвин ги пронаоѓа сите записи за најавениот корисник во табелата за трансакции, потоа са секој од записите го пронаоѓа корисничкото име на корисниците помеѓу кој била направена трансакцијата. Од записот и корисничките имиња креира нов објект од тип TransactionViewModel и истиот го додава во листа која потоа ќе се проследи до соодветниот поглед.

## AddBalance

AddBalance акцијата услужува два типа на барања, GET и POST. При GET барањата акцијата враќа поглед со податоци за тоа колку средства има најавениот корисник и форма преку која може да внесе средства. Откако ќе ја пополни формата и ќе го испрати барањето од тип POST, AddBalance акцијата ќе изврши неколку операции. Акцијата првично ќе провери дали внесените средства се позитивни, доколку се позитивни продолжува да провери дали корисникот има запис во табелата за сметки, доколку нема ја креира сметката ги додава средствата на сметката на корисникот. 

## BalancesController

BalancesController е API контролер кој овозможува динамичко вчитување на податоците за средствата на корисникот и по вчитување на страната. Контролерот има една акција Getbalance која ја враќа тековната состојба на средствата во сметката на тековно најавениот корисник. Податоците кој ги враќа оваа акција се прикажуваат во самото заглавје на апликацијата. Барањата до овој контролер се остварени со помош на ajax барање во BalanceScript.js скриптата и вратените инфорнации ги прикажува во елементот со Id account-balance во заглавјето.

# Погледи

Index погледот има задача испратените податоци за автомобилите да ги излиста и во зависност од улогата на најавениот корисник да овозможи неколку функционалности. Доколку корисникот е сопственик за возилата треба да обезбедат копчиња за сервис, ажурирање и бришење за секое од возилата. Сервис копчето при клик отвара диалог преку кој корисникот го избира типот на сервисот и со потврда на истиот се испраќа ајах барање до серверот. При клик на едит копчето страната не пренасочува на поглед каде што може да се променат податоците за автомобилот, додека копчето за бришење отвара диалог и при потврда на истиот испраќа ајах барање до серверот за бришење на записот за автомобилот. Администраторите на овој поглед може да ги вршат истите функционалности но додатно може и да изнајмуваат автомобили. За оваа функционалност за секој запис од табелата има посебно копче Rent и при кликнување истото отвара диалог каде корисникот може да избере од кој до кој датум сака да го изнајми автомобилот, формата за избор на датумите е изработена со користење на jQuery UI библиотеката и преку истата е овозможено да се забрани внес на датуми во кој возилото е недостапно или резервирано однапред, исто така не е дозволено да се внесат датуми од минатото.  
Корисниците без привилегии на овој поглед имаат само опција за изнајмување додека ненајавените корисници ја немаат никакви опции.

MyRentedCars погледот е достапен за корисниците со корисничка улога и администраторите. На погледот има три табели но коорисникот избира која ќе се прикажува преку соодветни копчиња. Во првата табела се излистани возила кој биле изнајмени во минатото и за секој запис на корисникот му се претставени две функционалности за повторно изнајмување на возилото и бришење на записот. Во втората табела корисникот може да ги види сите тековни изнајмени автомобили, додека во третата табела корисникот може да ги види автомобилите кој се резервирани за во иднина.

ServiceCars погледот е достапен само за корисниците со корисничка улога сопственик. На погледот има две табели од кои корисникот избира која ќе се прикажува преку соодветни копчиња. Во првата табела се излистани записи од автомобилите кој порано биле сервисирани и истите може да се избришат. На втората табела се прикажани автомобили кој моментално се на сервис.

# Улоги и Пристап

Апликацијата ги има следните улоги со соодветно наведен пристап за секоја од улогите:

* Owner  
  * Можат да вршат креирање, ажурирање и бришење на записите за автомобилите  
  * Може да ги испраќаат автомобилите на сервис  
  * Имаат преглед за сите автомобили кој се или биле на сервис  
  * Имаат пристап до акцијата за промена на улоги  
  * Може да додадат средства на сметката на компанијата  
  * Имаат преглед на сите трансакции извршени со апликацијата  
* Admin  
  * Можат да вршат креирање, ажурирање и бришење на записите за автомобилите  
  * Може да ги испраќаат автомобилите на сервис  
  * Може да изнајмат автомобил  
  * Имаат пристап до погледот каде што може да ги видат тековните минатите и резервираните изнајмувања.  
  * Имаат пристап до акцијата за промена на улоги  
  * Може да оставаат коментари за автомобилот  
  * Може да додадат средства на својата сметка  
  * Имаат преглед само за трансакциите кој се поврзани со нивната сметка  
* User  
  * Имаат пристап до погледот каде што се листаат автомобилите  
  * Може да изнајмат автомобил  
  * Имаат пристап до погледот каде што може да ги видат тековните минатите и резервираните изнајмувања.  
  * Може да додадат средства на својата сметка  
  * Може да оставаат коментари за автомобилот  
  * Имаат преглед само за трансакциите кој се поврзани со нивната сметка  
* Анонимни корисници  
  * Имаат пристап до погледот каде што се листаат автомобилите
